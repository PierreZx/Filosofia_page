<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog do Grupo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css" />
</head>
<body class="body">

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>Menu</h3>
        <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Abrir menu lateral">
          <i class="fas fa-bars"></i>
        </button>
    </div>
    <ul class="sidebar-links">
      <li><a href="#post-grupo" onclick="toggleSidebar()"><i class="fas fa-users"></i> Grupo</a></li>
      <li><a href="#" onclick="openPostModal(); toggleSidebar()"><i class="fas fa-circle-plus"></i> Novo Post</a></li>
    </ul>
    <div class="sidebar-footer">
      <p>Blog de Filosofia</p>
    </div>
  </div>

  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="main-content" id="main-content">
    <nav class="navbar">
      <div class="navbar-container">
        <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Abrir menu lateral">
          <i class="fas fa-bars"></i>
        </button>
        <h1 class="logo">Filosofia</h1>
        <div class="content-below">
          <div class="integrantes">
            Ana Clara ¬∑ Maria ¬∑ Giovanna ¬∑ Vit√≥ria ¬∑ Hugo
          </div>
          <ul class="nav-links">
            <li><a href="#post-grupo">Post do Grupo</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="linha-separadora"></div>

    <div class="blog" id="post-grupo">
      <div class="blog-topo">
        <button onclick="mostrar('ana')" id="btn-ana">Ana Clara</button>
        <button onclick="mostrar('maria')" id="btn-maria">Maria</button>
        <button onclick="mostrar('giovanna')" id="btn-giovanna">Giovanna</button>
        <button onclick="mostrar('vitoria')" id="btn-vitoria">Vit√≥ria</button>
        <button onclick="mostrar('hugo')" id="btn-hugo">Hugo</button>
      </div>
      <div class="conteudo">
        <div class="pessoa ativa" id="ana">
          <img src="imagens/foto_ana.jpeg" alt="Ana Clara" />
          <div class="info">
            <h3>Ana Clara</h3>
            <p>Ana Clara √© a mais companheira, sempre disposta a ajudar e apoiar o grupo.</p>
          </div>
        </div>
        <div class="pessoa" id="maria">
          <img src="imagens/foto_maria.jpeg" alt="Maria" />
          <div class="info">
            <h3>Maria</h3>
            <p>Maria √© espont√¢nea e divertida, trazendo leveza aos momentos dif√≠ceis.</p>
          </div>
        </div>
        <div class="pessoa" id="giovanna">
          <img src="imagens/foto_giovanna.jpeg" alt="Giovanna" />
          <div class="info">
            <h3>Giovanna</h3>
            <p>Giovanna √© calma e paciente, uma presen√ßa est√°vel em meio √† turbul√™ncia.</p>
          </div>
        </div>
        <div class="pessoa" id="vitoria">
          <img src="imagens/foto_vitoria.jpeg" alt="Vit√≥ria" />
          <div class="info">
            <h3>Vit√≥ria</h3>
            <p>Vit√≥ria √© conhecida por sua sinceridade, falando sempre o que pensa com honestidade.</p>
          </div>
        </div>
        <div class="pessoa" id="hugo">
          <img src="imagens/foto_hugo.png" alt="Hugo" />
          <div class="info">
            <h3>Hugo</h3>
            <p>Hugo √© leal, algu√©m em quem todos confiam e que nunca abandona os amigos.</p>
          </div>
        </div>
      </div>
      <span class="botao-curtir" onclick="curtir(this)">‚ù§</span>
    </div>

    <div id="novos-posts-container"></div>
  </div>

<div class="modal-overlay" id="post-modal">
  <div class="modal-content">
    <div class="modal-header" style="position: relative;">
      <h3>Criar Novo Post</h3>
      <button class="close-modal" onclick="closePostModal()" aria-label="Fechar modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-novo-post">
        <div class="form-group">
          <label for="post-titulo">T√≠tulo do Post</label>
          <input type="text" id="post-titulo" placeholder="Nome do Fil√≥sofo" required>
        </div>
        
        <div class="form-group">
          <label for="post-imagem">URL da Imagem</label>
          <input type="text" id="post-imagem" placeholder="Cole o link da imagem aqui" required>
          <small>Recomendado: 300x300px ou propor√ß√£o 1:1</small>
        </div>
        
        <div class="form-group">
          <label for="post-texto">Conte√∫do</label>
          <textarea id="post-texto" rows="8" placeholder="Escreva sobre o fil√≥sofo..." required></textarea>
        </div>
        
        <div class="form-actions modal-buttons">
          <button type="button" class="btn-cancel" onclick="closePostModal()">Cancelar</button>
          <button type="submit" class="btn-confirm">Publicar Post</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal-overlay" id="edit-modal">
  <div class="modal-content">
    <div class="modal-header" style="position: relative;">
      <h3>Editar Post</h3>
      <button class="close-modal" onclick="closeEditModal()" aria-label="Fechar modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="form-edit-post">
        <input type="hidden" id="edit-post-key"> <div class="form-group">
          <label for="edit-post-titulo">T√≠tulo do Post</label>
          <input type="text" id="edit-post-titulo" required>
        </div>
        
        <div class="form-group">
          <label for="edit-post-imagem">URL da Imagem</label>
          <input type="text" id="edit-post-imagem" required>
        </div>
        
        <div class="form-group">
          <label for="edit-post-texto">Conte√∫do</label>
          <textarea id="edit-post-texto" rows="8" required></textarea>
        </div>
        
        <div class="form-actions modal-buttons">
          <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancelar</button>
          <button type="submit" class="btn-confirm">Salvar Altera√ß√µes</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script type="module">
// Importar fun√ß√µes do Firebase (Simplificado)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics.js";

console.log("Iniciando Firebase...");

const firebaseConfig = {
  apiKey: "AIzaSyCETtqx-gL3DthYwRdcnzHNdgLL-CgB8TU",
  authDomain: "filosofia-5d273.firebaseapp.com",
  projectId: "filosofia-5d273",
  storageBucket: "filosofia-5d273.appspot.com",
  messagingSenderId: "994283349897",
  appId: "1:994283349897:web:aace473de0968022df2358",
  measurementId: "G-37YR9KQHLZ",
  databaseURL: "https://filosofia-5d273-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getDatabase(app);

console.log("Firebase inicializado com sucesso.");

// Fun√ß√µes normais do site
window.mostrar = function(id) {
  document.querySelectorAll('.pessoa').forEach(p => p.classList.remove('ativa'));
  document.querySelectorAll('.blog-topo button').forEach(b => b.classList.remove('ativo'));
  document.getElementById(id).classList.add('ativa');
  document.getElementById('btn-' + id).classList.add('ativo');
}

window.curtir = function(el) {
  el.classList.toggle('curtiu');
}

window.toggleSidebar = function() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  sidebar.classList.toggle('active');
  overlay.classList.toggle('active');
  document.body.classList.toggle('sidebar-active');
}

window.openPostModal = function() {
  const modal = document.getElementById('post-modal');
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  setTimeout(() => {
    document.getElementById('post-titulo').focus();
  }, 300);
}

window.closePostModal = function() {
  const modal = document.getElementById('post-modal');
  modal.classList.remove('active');
  document.body.style.overflow = 'auto';
}

// Fun√ß√µes para o Modal de Edi√ß√£o (NOVAS)
let allPosts = {}; // Guarda os dados dos posts para f√°cil acesso na edi√ß√£o

window.openEditModal = function(key) {
    const post = allPosts[key];
    if (!post) {
        console.error("Post n√£o encontrado para edi√ß√£o:", key);
        return;
    }
    // Preenche o formul√°rio de edi√ß√£o com os dados do post
    document.getElementById('edit-post-key').value = key;
    document.getElementById('edit-post-titulo').value = post.title;
    document.getElementById('edit-post-imagem').value = post.image;
    document.getElementById('edit-post-texto').value = post.content;

    const modal = document.getElementById('edit-modal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

window.closeEditModal = function() {
    const modal = document.getElementById('edit-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Carregar posts em tempo real (MODIFICADO para incluir bot√£o de Editar)
const postsRef = ref(db, 'posts');
const container = document.getElementById('novos-posts-container');

onValue(postsRef, (snapshot) => {
  container.innerHTML = ''; 
  allPosts = {}; // Limpa e recarrega os posts locais

  if (!snapshot.exists()) {
    console.log("Nenhum post encontrado.");
  }
  snapshot.forEach(child => {
    const post = child.val();
    const key = child.key;
    allPosts[key] = post; // Armazena o post para a fun√ß√£o de edi√ß√£o

    // Adiciona o bot√£o de editar (‚úèÔ∏è) ao lado do de excluir (üóëÔ∏è)
    const postHTML = `
      <div class="blog" id="${key}">
        <div class="blog-topo">
          <button class="ativo">${post.title}</button>
          <div>
            <button onclick="openEditModal('${key}')">‚úèÔ∏è</button>
            <button onclick="deletePost('${key}')">üóëÔ∏è</button>
          </div>
        </div>
        <div class="conteudo">
          <div class="pessoa ativa">
            <img src="${post.image}" alt="${post.title}">
            <div class="info">
              <h3>${post.title}</h3>
              <p>${post.content.replace(/\n/g, '<br>')}</p>
            </div>
          </div>
        </div>
        <span class="botao-curtir" onclick="curtir(this)">‚ù§</span>
      </div>
    `;
    container.insertAdjacentHTML('beforeend', postHTML);
  });
}, (error) => {
  console.error("Erro ao carregar posts:", error);
});

// Fun√ß√£o para excluir post
window.deletePost = function(key) {
  if (!confirm("Tem certeza que deseja excluir este post?")) return;
  
  const postRef = ref(db, 'posts/' + key);
  remove(postRef)
    .then(() => console.log("Post removido com sucesso"))
    .catch(err => console.error("Erro ao remover post:", err));
}

// Enviar novo post (L√≥gica original, simplificada)
document.getElementById('form-novo-post').addEventListener('submit', function(e) {
  e.preventDefault();
  const title = document.getElementById('post-titulo').value.trim();
  const image = document.getElementById('post-imagem').value.trim();
  const content = document.getElementById('post-texto').value.trim();

  if (!title || !image || !content) {
    alert("Por favor, preencha todos os campos.");
    return;
  }

  push(postsRef, { title, image, content })
    .then(() => {
      console.log("Post enviado com sucesso.");
      closePostModal();
      this.reset();
    })
    .catch(err => {
      console.error("Erro ao salvar:", err);
      alert("Ocorreu um erro ao publicar o post.");
    });
});

// Salvar post editado (NOVA FUN√á√ÉO)
document.getElementById('form-edit-post').addEventListener('submit', function(e) {
    e.preventDefault();
    const key = document.getElementById('edit-post-key').value;
    const title = document.getElementById('edit-post-titulo').value.trim();
    const image = document.getElementById('edit-post-imagem').value.trim();
    const content = document.getElementById('edit-post-texto').value.trim();

    const postData = { title, image, content };
    const postToUpdateRef = ref(db, 'posts/' + key);

    update(postToUpdateRef, postData)
        .then(() => {
            console.log("Post atualizado com sucesso");
            closeEditModal();
        })
        .catch(err => {
            console.error("Erro ao atualizar post:", err);
            alert("Erro ao salvar as altera√ß√µes.");
        });
});


// Fechar modais ao clicar fora ou com a tecla ESC
['post-modal', 'edit-modal'].forEach(modalId => {
  document.getElementById(modalId).addEventListener('click', function(e) {
    if (e.target === this) {
      window.closePostModal();
      window.closeEditModal();
    }
  });
});

window.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    window.closePostModal();
    window.closeEditModal();
  }
});

</script>

</body>
</html>